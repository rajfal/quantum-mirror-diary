---
// src/pages/[date].astro
import DiaryEntryLayout from '../layouts/DiaryEntryLayout.astro';
import { getCollection } from 'astro:content';

import { getCypherDate } from '../utils/getCypherDate.js';


export async function getStaticPaths() {
  const present = await getCollection('present-reality');
  const future = await getCollection('future-echo');
  const reflection = await getCollection('reflection-point');

  // Combine slugs (filenames without extension) across all 3 folders
  const allDates = new Set([
    ...present.map((entry) => entry.slug),
    ...future.map((entry) => entry.slug),
    ...reflection.map((entry) => entry.slug),
  ]);

  return Array.from(allDates).map((slug) => ({
    params: { date: slug },
  }));
}

const { date } = Astro.params;

const cypherTimestamp = getCypherDate(date);

import { getEntryBySlug } from 'astro:content';

const presentEntry = await getEntryBySlug('present-reality', date);
const futureEntry = await getEntryBySlug('future-echo', date);
const reflectionEntry = await getEntryBySlug('reflection-point', date);
---

<DiaryEntryLayout 
  date={cypherTimestamp}
  showIntent={false} 
  present={presentEntry?.rendered?.html ?? `<em>No Present entry for ${date}</em>`}
  future={futureEntry?.rendered?.html ?? `<em>No Future entry for ${date}</em>`}
reflection={reflectionEntry?.rendered?.html ?? `<em>No Reflection entry for ${date}</em>`}
/>